---
title: "Expected incremental benefit plot"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{ceac}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.width = 6,
  fig.height = 6
)
```

```{r setup, results='hide', message=FALSE, warning=FALSE, echo=FALSE}
library(BCEA)
library(dplyr)
library(reshape2)
library(ggplot2)
library(purrr)
```


## Introduction

The intention of this vignette is to show how to plot different styles of expected incremental benefit (EIB) plots using the BCEA package.

## Two interventions only

This is the simplest case, usually an alternative intervention ($i=1$) versus status-quo ($i=0$).

The plot is based on the incremental benefit as a function of the willingness to pay $k$.

$$
IB(\theta) = k \Delta_e - \Delta_c
$$

Using the set of $S$ posterior samples, the EIB is approximated by

$$
\frac{1}{S} \sum_s^S IB(\theta_s)
$$

where $\theta_s$ is the realised configuration of the parameters $\theta$ in correspondence of the s-th simulation.


#### R code

To calculate these in BCEA we use the `bcea()` function.

```{r}
data(Vaccine)

he <-
  bcea(e, c,                  
       ref = 2,                
       interventions = treats, 
       Kmax = 50000,
       plot = FALSE)

eib.plot(he)
```

The vertical line represents the break-even value corresponding to $k^*$ indicating that above that threshold the alternative treatment is more cost-effective than the status-quo.

$$
k^* = \min\{ k : \mbox{EIB} > 0 \}
$$

This will be at the point the curve crosses the x-axis.

The plot defaults to base R plotting. Type of plot can be set explicitly using the `graph` argument.

```{r}
eib.plot(he, graph = "base")
eib.plot(he, graph = "ggplot2")
# ceac.plot(he, graph = "plotly")
```

Other plotting arguments can be specified such as title, line colours and theme.

```{r}
eib.plot(he,
          graph = "ggplot2",
          title = "my title",
          line = list(colors = "green"),
          theme = theme_dark())
```

## Multiple interventions

This situation is when there are more than two interventions to consider.
Incremental values can be obtained either always against a fixed reference intervention, such as status-quo, or for all pair-wise comparisons.

### Pair-wise comparisons

Without loss of generality, if we assume status-quo intervention $i=0$, then we wish to calculate

$$
\frac{1}{S} \sum_s^S IB(\theta^{i0}_s) \;\; \mbox{for each} \; i
$$

The break-even points represent no preference between the two best interventions at $k$.

$$
k^*_i = \min\{ k : \mbox{EIB}(\theta^i) > \mbox{EIB}(\theta^j) \}
$$

Only the right-most of these will be where the curves cross the x-axis.

#### R code

This is the default plot for `eib.plot()` so we simply follow the same steps as above with the new data set.

```{r}
data(Smoking)

treats <- c("No intervention", "Self-help",
            "Individual counselling", "Group counselling")
he <- bcea(e, c, ref = 4, interventions = treats, Kmax = 500)

eib.plot(he)
```

```{r}
eib.plot(he,
          graph = "base",
          title = "my title",
          line = list(colors = "green"))
```

```{r}
eib.plot(he,
          graph = "ggplot2",
          title = "my title",
          line = list(colors = "green"))
```

Reposition legend.

```{r}
eib.plot(he, pos = FALSE) # bottom right
eib.plot(he, pos = c(0, 0))
eib.plot(he, pos = c(0, 1))
eib.plot(he, pos = c(1, 0))
eib.plot(he, pos = c(1, 1))
```

```{r}
eib.plot(he, graph = "ggplot2", pos = c(0, 0))
eib.plot(he, graph = "ggplot2", pos = c(0, 1))
eib.plot(he, graph = "ggplot2", pos = c(1, 0))
eib.plot(he, graph = "ggplot2", pos = c(1, 1))
```

Define colour palette.

```{r}
mypalette <- RColorBrewer::brewer.pal(3, "Accent")

eib.plot(he,
          graph = "base",
          title = "my title",
          line = list(colors = mypalette),
          pos = FALSE)

eib.plot(he,
          graph = "ggplot2",
          title = "my title",
          line = list(colors = mypalette),
          pos = FALSE)
```

### Against a fixed reference intervention

We wish to calculate the same curves as in the multiple comparison case.
However, now each interventions is compared against a reference e.g. the status-quo.
So the break-even points represent the willingness to pay where there is no preference between the reference and each of the other interventions.

$$
k^*_i = \min\{ k : \mbox{EIB}(\theta^{i0}) > 0 \}
$$

This means that the vertical lines occur where the EIB curves cross the x-axis.


#### R code

```{r}
```

```{r echo=FALSE}
# create output docs
# rmarkdown::render(input = "vignettes/ceac.Rmd", output_format = "pdf_document", output_dir = "vignettes")
# rmarkdown::render(input = "vignettes/ceac.Rmd", output_format = "html_document", output_dir = "vignettes")
```
